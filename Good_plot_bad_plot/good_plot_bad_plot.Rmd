---
title: "Good plot/ bad plot"
author: "Kassandra Jensen"
date: "2024-10-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Directions: Good plot Bad plot lab - competition
Due October 29

Your homework is to create two version of similar plots, using any dataset you choose. You must create the plots using ggplot2, post-processing with Adobe Illustrator or similar is not allowed. This homework is a contest, and the winner will win a prize to be disclosed.
Please submit your homework by posting a markdown document containing the plots, the code you used to create them, and your discussion of the plot within the markdown doc to github. Data also needs to be submitted.
The first plot should be as bad as possible. Your reading from Claus Wilke’s and Healy's textbook describe the many ways that a plot can become misleading, difficult to interpret, or or just plain ugly, and you should use all of the tools that you can. Please try to make me, a person who cares a great deal about high-quality data visualization, cry.
You should explain in text all of the ways in which the bad plot is bad. Bullet points are fine, but clearly articulate each principle of data visualization that you have broken.
The second plot should be based on the same or similar data to the first plot, but it should be good. Write briefly about why this is a successful plot.
All plots must be made in ggplot2, with code visible in the Rmarkdown document.
The data must be visible.
The good plot and the bad plot should be based on the same, or similar, data.

# Load libraries
```{r}
library(tidyverse)
library(janitor)
library(usmap)
library(wordcloud2)
```

# Load data:
```{r}
weather_forecasts <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/weather_forecasts.csv')
outlook_meanings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/outlook_meanings.csv')

cities <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/cities.csv') 

## This is part of the data, but I opted to use usmap package to make my map instead. 


view(weather_forecasts)
view(outlook_meanings)
view(cities)
```

# Clean data
I am only interested in full data, so I am dropping rows where forecast temperature and observed precipitation are NA. 
```{r}
weather_forecasts_filtered <- weather_forecasts %>%               ## call data
  drop_na(forecast_temp) %>%                                      ## drops NA's in forecast_temp column 
  drop_na(observed_precip) %>%                                    ## drops NA's in observed_precip column 
  mutate(temp_accuracy = abs(forecast_temp - observed_temp)) %>%## getting error of forecast by taking absolute value of forecast minus the observed
  group_by(state)                                                 ## group by state to get accuracy

view(weather_forecasts_filtered)
```

# Bad plot
Bad way to display a lot of data, scale is off and doesn't showcase differeces between states, ugly colors. 
```{r}
## note to self: add some bad labels and photos maybe - if poss, put out of order or do photos to represent the state labels?

ggplot(weather_forecasts_filtered, aes(x = date, y = state, fill = temp_accuracy)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "green", high = "red", name = "Temperature Accuracy\n(Difference)") +
  labs(title = "Temperature Forecast Accuracy",
       x = "Date", y = "City") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
# Good plot: Map
```{r}
average_accuracy_by_state <- weather_forecasts_filtered %>%
  filter(temp_accuracy >= 0 & temp_accuracy <= 55) %>%  # Exclude 0s
  group_by(state) %>%
  summarise(avg_temp_accuracy = mean(temp_accuracy, na.rm = TRUE))

            
plot_usmap(data = average_accuracy_by_state, values = "avg_temp_accuracy", color = "white") +
  scale_fill_gradient(low = "white", high = "darkgreen", name = "Max Temp Accuracy") + 
  theme_minimal() + 
  labs(title = "Maximum Temperature Forecast Accuracy by State",
       subtitle = "Accuracy range filtered to 0-55",
       caption = "Data Source: weather_forecasts")

```


# Part 2
## Clean Data
```{r}
weather_forecasts_HI <- weather_forecasts%>%          ## Call data
  filter (state == "HI") %>%                          ## Only Hawai‘i
  drop_na(forecast_outlook)                           ## Get rid or NAs in column

## Check for which types of forecast outlooks there are 
unique(weather_forecasts_HI$forecast_outlook)

## Rename everything to unabbreviated name 
weather_forecasts_HI <- weather_forecasts_HI %>%                                                    
  mutate(forecast_outlook = if_else(forecast_outlook == "SUNNY", "Sunny", forecast_outlook)) %>%
  mutate(forecast_outlook = if_else(forecast_outlook == "MOCLDY", "Mostly Cloudy", forecast_outlook))%>%
  mutate(forecast_outlook = if_else(forecast_outlook == "PTCLDY", "Partly Cloudy", forecast_outlook))%>%
  mutate(forecast_outlook = if_else(forecast_outlook == "SHWRS", "Rain Showers", forecast_outlook))%>%
  mutate(forecast_outlook = if_else(forecast_outlook == "CLOUDY", "Cloudy", forecast_outlook))%>%
  mutate(forecast_outlook = if_else(forecast_outlook == "WINDY", "Windy", forecast_outlook))%>%
  mutate(forecast_outlook = if_else(forecast_outlook == "TSTRMS", "Thunderstorms", forecast_outlook))

weather_forecasts_HI_counts<- weather_forecasts_HI %>% 
  group_by(forecast_outlook) %>%
  summarise(count = n())

## View to make sure it's what I want
view(weather_forecasts_HI)
```

# Bad plot
# Actual bad plot
```{r}
ggplot(weather_forecasts_HI, aes(x = reorder(forecast_outlook, -count), y = 1, fill = count)) +
  geom_tile(color = "magenta", size = 2) + 
  geom_text(aes(label = count), size = 25, color = "yellow", angle = 90) +  
  scale_fill_gradient(low = "limegreen", high = "red") +  
  labs(title = "Weather Forecast Counts", x = "Forecast Outlook", y = "") +
  theme_void() + 
  theme(
    plot.title = element_text(size = 20, face = "bold.italic", hjust = 0.5, color = "blue"),  
    legend.position = "top", 
    panel.grid.major = element_line(size = 1, color = "cyan"),  
    panel.grid.minor = element_line(size = 1, color = "purple"),  
    axis.text.x = element_text(size = 14, face = "bold", color = "orange", angle = 45)  
  ) +
  coord_fixed(ratio = 1.5)  

ggsave(here("Good_plot_bad_plot","Output","badplot.png"))

```
# Good plot
### Data manipulation
```{r}
weather_forecasts_HI <- weather_forecasts_HI %>%   ## call data
  mutate(month_year = floor_date(date, "month"))   ## round data to nearest month 

forecast_counts <- weather_forecasts_HI %>%        ## call data
  group_by(month_year, forecast_outlook) %>%       ## group by date and forecast because that's all we care about
  summarise(count = n()) %>%                       ## n() counts the unique observations of what I put in groupby() 
  ungroup()  

```

### Plot
```{r}
ggplot(forecast_counts, aes(x = month_year,                             ## call data, put month_year as x axis
                            y = forecast_outlook)) +                    ## forecast as y- axis
  geom_tile(aes(fill = count), color = "white") +                       ## use geom_tile for heat map
  scale_fill_gradient(low = "lightblue", high = "darkblue") +           ## pretty colors
  labs(title = "Frequency of Forecast Outlooks Overtime",              ## titles
       x = "Month-Year",
       y = "Forecast Outlook",
       fill = "Count") +
  theme_minimal() +                                                     ## minimal theme
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggsave(here("Good_plot_bad_plot","Output","goodplot.png"))
```

